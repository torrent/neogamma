### üìù Security Note: Menubar Tampering Incident and Mitigation

**Incident Summary**  
In early January 2026, a malicious user was able to overwrite the `Menubar` page on a PukiWiki installation, despite password protection being enabled. This suggests that either:

- The attacker bypassed the password mechanism via a vulnerability or misconfiguration, or  
- The password protection was not enforced under certain conditions (e.g., via direct POST requests or plugin behavior).

**Observed Behavior**  
The attacker repeatedly inserted spam links to external profiles and services, including:

- `pixiv.net/users/660798`  
- `fanbox.cc`, `misskey.io`, `discord.gg`, `marshmallow-qa.com`, `skeb.jp`, etc.
**Mitigation Implemented**  
To prevent further tampering, a content-based filter was added directly to `plugin/edit.inc.php`, just before the `page_write()` call. The filter blocks any edits to `Menubar` that contain known spam patterns:

```php
$ng_patterns = [
    'hoshikuzu660798',
    'pixiv.net/users/660798',
    'fanbox.cc',
    'misskey.io/@hoshikuzu',
    'discord.gg/',
    'marshmallow-qa.com',
    'skeb.jp/@',
    'youtube.com/@hoshikuzu',
    'x.com/hoshikuzu',
];

if ($page === 'Menubar') {
    foreach ($ng_patterns as $pattern) {
        if (strpos($postdata, $pattern) !== false) {
            error_log("Blocked edit to $page due to forbidden pattern: $pattern");
            die('This content cannot be saved (forbidden pattern detected).');
        }
    }
}
```

